
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orchestrator Demo UI</title>
  <link rel="stylesheet" href="/v1/orchestrator/styles.css" />
</head>
<body>
  <header>
    <h1><a href="/v1/orchestrator/" data-route-link="overview">Orchestrator Demo UI</a></h1>
    <nav>
      <a href="/v1/orchestrator/" data-route-link="overview">Overview</a>
      <a href="/v1/orchestrator/inputs" data-route-link="inputs">Inputs</a>
      <a href="/v1/orchestrator/workflows" data-route-link="workflows">Workflows</a>
      <a href="/v1/orchestrator/outputs" data-route-link="outputs">Outputs</a>
      <a href="/v1/orchestrator/logics" data-route-link="logics">Logics & Enrichment</a>
      <a href="/v1/orchestrator/workflows#samples" data-route-link="samples">Samples</a>
      <a href="/v1/orchestrator/graph.html" target="_blank">Graph Demo</a>
      <a href="/v1/orchestrator/openapi.yaml" target="_blank">OpenAPI</a>
    </nav>
  </header>

  <main class="dashboard" style="--row1: 66.6667%; --col1: 25%; --col3: 25%; --bottomCol1: 50%;">
    <aside class="sidebar" aria-label="Sections">
      <a class="sidebar-item" href="/v1/orchestrator/inputs" title="Input" data-route-link="inputs"><span aria-hidden="true">ğŸ“¥</span></a>
      <a class="sidebar-item" href="/v1/orchestrator/workflows" title="Workflow" data-route-link="workflows"><span aria-hidden="true">ğŸ§©</span></a>
      <a class="sidebar-item" href="/v1/orchestrator/outputs" title="Output" data-route-link="outputs"><span aria-hidden="true">ğŸ“¤</span></a>
      <a class="sidebar-item" href="/v1/orchestrator/logics" title="Logics" data-route-link="logics"><span aria-hidden="true">ğŸ§ </span></a>
    </aside>
    <section class="panel panel-input" data-route="inputs">
      <div class="panel-header">
        <h2 class="panel-title"><span class="panel-icon" aria-hidden="true">ğŸ“¥</span><a href="/v1/orchestrator/inputs" data-route-link="inputs">input</a></h2>
      </div>
      <div class="panel-body">
        <section id="input-defs" class="panel-section">
          <h3>Input Definitions</h3>
          <form id="inputDefForm" data-detail-only>
            <label>name <input name="name" value="webhook-orders" required></label>
            <label>type
              <select name="type">
                <option value="webhook" selected>webhook</option>
                <option value="udp">udp</option>
                <option value="tail">tail</option>
              </select>
            </label>
            <label>enabled <input type="checkbox" name="enabled" checked></label>
            <label>workflowId <input name="workflowId" value="wf-orders"></label>
            <label>topic <input name="topic" value="orders/new"></label>
            <label>source <input name="source" value="input:webhook-orders"></label>
            <label>eventType <input name="eventType" value="order"></label>
            <label>config(JSON)
              <textarea name="config">{
  "path": "/hooks/orders",
  "method": "POST"
}</textarea></label>
            <div class="toolbar">
              <button type="submit">Create Input</button>
              <button type="button" id="sampleWebhookBtn">Sample: Webhook</button>
              <button type="button" id="sampleUdpBtn">Sample: UDP</button>
              <button type="button" id="sampleTailBtn">Sample: Tail</button>
            </div>
          </form>
          <div class="table-wrap">
            <table id="inputDefsTable">
              <thead><tr><th>id</th><th>name</th><th>type</th><th>enabled</th><th>workflowId</th><th>topic</th><th>source</th><th>actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <section id="input-events" class="panel-section">
          <h3>Input Events</h3>
          <form id="inputForm" data-detail-only>
            <label>source <input name="source" value="demo-ui" required></label>
            <label>topic <input name="topic" value="demo/topic" required></label>
            <label>type <input name="type" value="demo"></label>
            <label>payload(JSON) <textarea name="payload">{"message":"hello"}</textarea></label>
            <button type="submit">Send</button>
          </form>
          <div class="table-wrap">
            <table id="inputsTable">
              <thead><tr><th>time</th><th>source</th><th>topic</th><th>type</th><th>payload</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </div>
    </section>

    <section class="panel panel-workflow" id="workflows" data-route="workflows">
      <div class="panel-header">
        <h2 class="panel-title"><span class="panel-icon" aria-hidden="true">ğŸ§©</span><a href="/v1/orchestrator/workflows" data-route-link="workflows">workflow</a></h2>
      </div>
      <div class="panel-body">
        <form id="wfForm" data-detail-only>
          <label>name <input name="name" value="wf-demo" required></label>
          <label>enabled <input type="checkbox" name="enabled" checked></label>
          <label>sourceTopics (comma) <input name="sourceTopics" value="demo/topic"></label>
          <label>outputTopic <input name="outputTopic" value="demo/output"></label>
          <label>outputs(JSON)
            <textarea name="outputs">[
        {"type":"topic","topic":"demo/output"},
        {"type":"broadcast","channel":"broadcast","topic":"demo/broadcast"}
      ]</textarea></label>
          <label>steps(JSON)
            <textarea name="steps">[
  {"type":"debounce","ms":200},
  {"type":"logic","logicId":"prefectures","params":{"code":"payload.prefCode"},"targetField":"payload.enriched.pref"},
  {"type":"tapLog","label":"debug"},
  {"type":"branch","branches":[
     {"when":{"field":"payload.message","equals":"hello"},
      "set":{"reply":"world"},
      "outputTopic":"demo/branch"}
  ]}
]</textarea></label>
          <button type="submit">Create Workflow</button>
        </form>

        <div class="table-wrap">
          <table id="wfTable">
            <thead><tr><th>id</th><th>name</th><th>enabled</th><th>sourceTopics</th><th>outputTopic</th><th>actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card detail" id="wfDetail" data-detail-only>
          <div class="muted">ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
        </div>

        <details data-detail-only>
          <summary>ãƒ­ã‚¸ãƒƒã‚¯ã®èª¬æ˜</summary>
          <ul>
            <li><b>filterEquals</b>: æŒ‡å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå€¤ã¨ä¸€è‡´ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿é€šé</li>
            <li><b>mapFields</b>: `{ ç›®æ¨™ãƒ‘ã‚¹: å–å¾—å…ƒãƒ‘ã‚¹ }` ã§ payload ã‚’å†æ§‹æˆ</li>
            <li><b>debounce</b>: ç›´è¿‘ã®å€¤ã®ã¿ã‚’é…å»¶å‡ºåŠ› (ms)</li>
            <li><b>throttle</b>: é«˜é »åº¦å…¥åŠ›ã‚’ä¸€å®šé–“éš”ã§é–“å¼•ã (ms)</li>
            <li><b>delay</b>: å‡ºåŠ›ã‚’é…å»¶ (ms)</li>
            <li><b>aggregateCount</b>: ä¸€å®šæ™‚é–“çª“ã§ä»¶æ•°ã‚’é›†è¨ˆ (windowMs, keyField)</li>
            <li><b>output</b>: æŒ‡å®š output ã¸ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãã®ã¾ã¾é€å‡º (target ã¾ãŸã¯ topic)</li>
            <li><b>logic</b>: çµ±åˆãƒ­ã‚¸ãƒƒã‚¯ã€‚built-in/embedded/webhook ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ payload ã«è£œå®Œ</li>
            <li><b>enrich</b>: å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿å–å¾— + ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¡Œã„ã€çµæœã‚’ payload ã«è£œå®Œ</li>
            <li><b>setTopic</b>: ã‚¤ãƒ™ãƒ³ãƒˆã® topic ã‚’å·®ã—æ›¿ãˆ</li>
            <li><b>mergeWithTopics</b>: ä»–ãƒˆãƒ”ãƒƒã‚¯ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆæµ</li>
            <li><b>raceTopics</b>: è¤‡æ•°ãƒˆãƒ”ãƒƒã‚¯ã®ã†ã¡æœ€åˆã«æ¥ãŸã‚¹ãƒˆãƒªãƒ¼ãƒ ã«è¿½å¾“</li>
            <li><b>branch</b>: æ¡ä»¶ã«ãƒãƒƒãƒã—ãŸå ´åˆã€<i>ã‚µã‚¤ãƒ‰å‡ºåŠ›</i>ã¨ã—ã¦å³æ™‚ã« output ã‚’ç™ºè¡Œ (å…ƒã‚¤ãƒ™ãƒ³ãƒˆã¯æµã‚Œç¶šã‘ã¾ã™)</li>
            <li><b>tapLog</b>: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›</li>
          </ul>
        </details>

        <details id="samples" data-detail-only>
          <summary>Samples</summary>
          <div class="grid">
            <div class="card">
              <span class="badge">Input Definition</span>
              <h4>Webhook: Orders</h4>
              <p>HTTP ã§æ³¨æ–‡ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–ã‚Šè¾¼ã¿ã€æŒ‡å®š workflow ã«ãƒã‚¤ãƒ³ãƒ‰ã€‚</p>
              <div class="stack">
                <button type="button" id="createWebhookSample">Create Input</button>
                <span class="mono">POST /v1/orchestrator/hooks/orders</span>
              </div>
            </div>
            <div class="card">
              <span class="badge">Input Definition</span>
              <h4>UDP: Sensors</h4>
              <p>UDP ã§ JSON ã‚’å—ã‘ã€1ç§’é›†è¨ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¸æµã—ã¾ã™ã€‚</p>
              <div class="stack">
                <button type="button" id="createUdpSample">Create Input</button>
                <span class="mono">udp://:40123</span>
              </div>
            </div>
            <div class="card">
              <span class="badge">Workflow</span>
              <h4>Aggregate Count</h4>
              <p>1ç§’çª“ã§ `payload.deviceId` ã”ã¨ã®ä»¶æ•°ã‚’é›†è¨ˆã€‚</p>
              <div class="stack">
                <button type="button" id="createAggregateWf">Create Workflow</button>
                <button type="button" id="sendBurst">Send Burst Events</button>
              </div>
            </div>
            <div class="card">
              <span class="badge">Workflow</span>
              <h4>Enrich Orders</h4>
              <p>prefectures ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è£œå®Œã—ã¦å‡ºåŠ›ã€‚</p>
              <div class="stack">
                <button type="button" id="createEnrichWf">Create Workflow</button>
                <button type="button" id="sendOrderEvent">Send Sample Event</button>
              </div>
            </div>
          </div>
          <details>
            <summary>ã‚µãƒ³ãƒ—ãƒ« JSON</summary>
            <div class="split">
              <pre><code id="sampleInputWebhook" class="mono"></code></pre>
              <pre><code id="sampleWfAggregate" class="mono"></code></pre>
            </div>
          </details>
        </details>
      </div>
    </section>

    <section class="panel panel-output" id="outputs" data-route="outputs">
      <div class="panel-header">
        <h2 class="panel-title"><span class="panel-icon" aria-hidden="true">ğŸ“¤</span><a href="/v1/orchestrator/outputs" data-route-link="outputs">output</a></h2>
      </div>
      <div class="panel-body">
        <div class="table-wrap">
          <table id="outputsTable">
            <thead><tr><th>id</th><th>name</th><th>type</th><th>enabled</th><th>channel</th><th>path</th><th>builtin</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <div class="panel-row panel-row-bottom">
      <section class="panel panel-logics" id="logics" data-route="logics">
        <div class="panel-header">
          <h2 class="panel-title"><span class="panel-icon" aria-hidden="true">ğŸ§ </span><a href="/v1/orchestrator/logics" data-route-link="logics">logics</a></h2>
        </div>
        <div class="panel-body">
          <p class="muted">built-in / embedded ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã€è¿½åŠ ã§ãã‚‹ã®ã¯ webhook ã‚¿ã‚¤ãƒ—ã®ã¿ã§ã™ã€‚</p>

          <form id="logicForm" data-detail-only>
            <label>name <input name="name" value="logic-webhook-demo" required></label>
            <label>type
              <select name="type">
                <option value="webhook" selected>webhook</option>
              </select>
            </label>
            <label>enabled <input type="checkbox" name="enabled" checked></label>
            <label>config(JSON)
              <textarea name="config">{
  "url": "https://example.com/webhook",
  "method": "POST",
  "headers": { "Authorization": "Bearer YOUR_TOKEN" },
  "timeoutMs": 4000,
  "ttlMs": 60000
}</textarea></label>
            <div class="toolbar">
              <button type="submit">Create Logic</button>
              <button type="button" id="sampleLogicBtn">Sample: Webhook Logic</button>
            </div>
          </form>

          <div class="table-wrap">
            <table id="logicTable">
              <thead><tr><th>id</th><th>name</th><th>type</th><th>enabled</th><th>config</th><th>actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="panel panel-builtins" id="logic-detail" data-route="logics">
        <div class="panel-header">
          <h2 class="panel-title">logic detail</h2>
        </div>
        <div class="panel-body">
          <div id="logicDetail" class="detail">
            <div class="muted">ãƒ­ã‚¸ãƒƒã‚¯ã®è¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</div>
          </div>

          <div data-detail-only>
            <h3>Enrichment</h3>
          <p>
            <b>logic</b> ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆå†…ã®å€¤ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã—ã¦å†…è”µãƒ­ã‚¸ãƒƒã‚¯ / webhook ã‚’å®Ÿè¡Œã—ã€
            çµæœã‚’ payload ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹ãŸã‚æ¯å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚
            æ—¢å­˜ã® <b>enrich</b> ã‚¹ãƒ†ãƒƒãƒ—ã‚‚äº’æ›ã¨ã—ã¦åˆ©ç”¨ã§ãã¾ã™ã€‚
          </p>
          <p class="muted">ç‰¹åˆ¥ãª built-in ã® <b>loopback</b> ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ã†ã¨ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’ input/loopback ã¸æ˜ç¤ºçš„ã«å†æŠ•å…¥ã§ãã¾ã™ã€‚</p>

          <div class="toolbar">
            <button id="enrichReload">è£œå®Œã‚½ãƒ¼ã‚¹ã‚’å†èª­ã¿è¾¼ã¿</button>
            <button id="enrichClearCache">ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…¨æ¶ˆå»</button>
            <span class="muted">cache size: <b id="enrichCacheSize">-</b></span>
          </div>

          <div class="table-wrap">
            <table id="enrichTable">
              <thead>
                <tr>
                  <th>id</th>
                  <th>ttlMs</th>
                  <th>refreshIntervalMs</th>
                  <th>refreshable</th>
                  <th>actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <details>
            <summary>åˆ©ç”¨æ–¹æ³• / ã‚µãƒ³ãƒ—ãƒ«</summary>
            <h3>1) å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆä¾‹</h3>
            <pre><code>{
  "source": "demo-ui",
  "topic": "demo/topic",
  "type": "demo",
  "payload": {
    "message": "hello",
    "prefCode": 13,
    "userId": 1
  }
}</code></pre>

            <h3>2) ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¾‹ (steps ã®ã¿)</h3>
            <pre><code>[
  {
    "type": "logic",
    "logicId": "prefectures",
    "params": { "code": "payload.prefCode" },
    "targetField": "payload.enriched.pref"
  },
  {
    "type": "logic",
    "logicId": "jsonplaceholder-user",
    "params": { "id": "payload.userId" },
    "targetField": "payload.enriched.user",
    "cacheTtlMs": 300000
  }
]</code></pre>

            <h3>3) è£œå®Œçµæœ (å‡ºåŠ› payload ã®ä¾‹)</h3>
            <pre><code>{
  "message": "hello",
  "prefCode": 13,
  "userId": 1,
  "enriched": {
    "pref": { "code": 13, "name": "æ±äº¬éƒ½" },
    "user": { "id": 1, "name": "Leanne Graham", "username": "Bret", ... }
  }
}</code></pre>

            <details>
              <summary>åˆ©ç”¨å¯èƒ½ãªè£œå®Œã‚½ãƒ¼ã‚¹ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)</summary>
              <ul>
                <li><b>prefectures</b>: é™çš„ãƒªã‚¹ãƒˆ (åŒ—æµ·é“ / æ±äº¬éƒ½ / å¤§é˜ªåºœ ã‚’ã‚µãƒ³ãƒ—ãƒ«å†…è”µ)</li>
                <li><b>jsonplaceholder-user</b>: https://jsonplaceholder.typicode.com/users/{id} (GET)</li>
              </ul>
              <p>è¿½åŠ ã®è£œå®Œã‚½ãƒ¼ã‚¹ã¯ <code>src/enrichment.ts</code> ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã§å®šç¾©å¯èƒ½ã§ã™ã€‚</p>
            </details>
          </details>
          </div>
        </div>
      </section>
      <div class="resizer resizer-col resizer-bottom" aria-hidden="true"></div>
    </div>

    <div class="resizer resizer-col resizer-col-1" aria-hidden="true"></div>
    <div class="resizer resizer-col resizer-col-2" aria-hidden="true"></div>
    <div class="resizer resizer-row" aria-hidden="true"></div>
  </main>

  <footer>
    <small>Orchestrator Demo â€” Node.js + TypeScript + RxJS</small>
  </footer>

  <script src="/v1/orchestrator/app.js"></script>
</body>
</html>
